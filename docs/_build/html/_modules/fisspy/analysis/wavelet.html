

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fisspy.analysis.wavelet &mdash; FISSPy 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="FISSPy 0.7 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> FISSPy
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">FISSPy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>fisspy.analysis.wavelet</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fisspy.analysis.wavelet</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Calculate the wavelet and its significance.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.special._ufuncs</span> <span class="k">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gammainc</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">fminbound</span> <span class="k">as</span> <span class="n">fmin</span>
<span class="kn">from</span> <span class="nn">scipy.fftpack</span> <span class="k">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Juhyeong Kang&quot;</span>
<span class="n">__email__</span> <span class="o">=</span>  <span class="s2">&quot;jhkang@astro.snu.ac.kr&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wavelet&#39;</span><span class="p">,</span> <span class="s1">&#39;iwavelet&#39;</span><span class="p">,</span> <span class="s1">&#39;motherfunc&#39;</span><span class="p">,</span> <span class="s1">&#39;motherparam&#39;</span><span class="p">,</span>
           <span class="s1">&#39;wave_signif&#39;</span><span class="p">,</span> <span class="s1">&#39;chisquare_inv&#39;</span><span class="p">,</span> <span class="s1">&#39;chisquare_solve&#39;</span><span class="p">,</span>
           <span class="s1">&#39;wave_coherency&#39;</span><span class="p">,</span> <span class="s1">&#39;fast_conv&#39;</span><span class="p">,</span> <span class="s1">&#39;fast_conv2&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="wavelet"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.wavelet.html#fisspy.analysis.wavelet.wavelet">[docs]</a><span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span>
            <span class="n">dj</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">s0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">mother</span><span class="o">=</span><span class="s1">&#39;MORLET&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the wavelet transform of the given y</span>
<span class="sd">    with sampling rate dt.</span>
<span class="sd">    </span>
<span class="sd">    By default, the MORLET wavelet (k0=6) is used.</span>
<span class="sd">    The wavelet basis is normalized to have total energy=1</span>
<span class="sd">    at all scales.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : ~numpy.ndarray</span>
<span class="sd">        The time series of length n.</span>
<span class="sd">    dt : float</span>
<span class="sd">        The time step between each y values.</span>
<span class="sd">        i.e. the sampling time.</span>
<span class="sd">    dj : (optional) float</span>
<span class="sd">        The spacing between discrete scales.</span>
<span class="sd">        The smaller, the better scale resolution.</span>
<span class="sd">            * Default is 0.25</span>
<span class="sd">    s0 : (optional) float</span>
<span class="sd">        The smallest scale of the wavelet.  </span>
<span class="sd">            * Default is :math:`2 \cdot dt`.</span>
<span class="sd">    j : (optional) int</span>
<span class="sd">        The number of scales minus one.</span>
<span class="sd">        Scales range from :math:`s0` up to :math:`s_0\cdot 2^{j\cdot dj}`, to give</span>
<span class="sd">        a total of :math:`j+1` scales.</span>
<span class="sd">            * Default is :math:`j=\log_2{(\\frac{n dt}{s_0 dj})}`.</span>
<span class="sd">    mother : (optional) str</span>
<span class="sd">        The mother wavelet function.</span>
<span class="sd">        The choices are &#39;MORLET&#39;, &#39;PAUL&#39;, or &#39;DOG&#39;</span>
<span class="sd">            * Default is **&#39;MORLET&#39;**</span>
<span class="sd">    param  : (optional) int</span>
<span class="sd">        The mother wavelet parameter.\n</span>
<span class="sd">        For **&#39;MORLET&#39;** param is k0, default is **6**.\n</span>
<span class="sd">        For **&#39;PAUL&#39;** param is m, default is **4**.\n</span>
<span class="sd">        For **&#39;DOG&#39;** param is m, default is **2**.\n</span>
<span class="sd">    pad : (optional) bool</span>
<span class="sd">        If set True, pad time series with enough zeros to get</span>
<span class="sd">        N up to the next higher power of 2.</span>
<span class="sd">        This prevents wraparound from the end of the time series</span>
<span class="sd">        to the beginning, and also speeds up the FFT&#39;s </span>
<span class="sd">        used to do the wavelet transform.</span>
<span class="sd">        This will not eliminate all edge effects.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wave : ~numpy.ndarray</span>
<span class="sd">        The WAVELET transform of y.</span>
<span class="sd">        (j+1, n) complex arry.</span>
<span class="sd">        np.arctan2(wave.imag,wave.real) gives the WAVELET phase.</span>
<span class="sd">        wave.real gives the WAVELET amplitude.</span>
<span class="sd">        The WAVELET power spectrum is :math:`|wave|^2`.</span>
<span class="sd">    period : ~numpy.ndarray</span>
<span class="sd">        The vecotr of &#39;Fourier&#39; periods (in time units)</span>
<span class="sd">        that correspods to the scales.</span>
<span class="sd">    scale : ~numpy.ndarray</span>
<span class="sd">        The vecotr of scale indices, given by :math:`s_0 \cdot 2^{j \cdot dj}, </span>
<span class="sd">        j=0...j`</span>
<span class="sd">        where :math:`j+1` is the total number of scales.</span>
<span class="sd">    coi : ~numpy.ndarray</span>
<span class="sd">        The Cone-of-Influence, which is a vector of N points</span>
<span class="sd">        that contains the maximum period of useful information</span>
<span class="sd">        at that particular time.</span>
<span class="sd">        Periods greater than this are subject to edge effets.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        This function based on the IDL code WAVELET.PRO written by C. Torrence, </span>
<span class="sd">        and Python code waveletFuncitions.py written by E. Predybayalo.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from fisspy.analysis import wavelet</span>
<span class="sd">    &gt;&gt;&gt; wave, period, scale, coi = wavelet.wavelet(y,dt,dj=dj,j=j,mother=mother,pad=True)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">n0</span><span class="o">=</span><span class="n">n</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s0</span><span class="p">:</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">s0</span><span class="p">)</span><span class="o">/</span><span class="n">dj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">j</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="c1">#reconstruct the time series to analyze if set pad</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
        <span class="n">power</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mf">0.4999</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">power</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>
        <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="c1">#wavenumber</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="o">/</span><span class="n">dt</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="o">-</span><span class="n">k1</span><span class="p">[:</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.</span><span class="p">],</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">))</span>
    
    <span class="c1">#Scale array</span>
    <span class="n">scale</span><span class="o">=</span><span class="n">s0</span><span class="o">*</span><span class="mf">2.</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">*</span><span class="n">dj</span><span class="p">)</span>
    
    <span class="c1"># FFT</span>
    <span class="n">fx</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="n">nowf</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">fourier_factor</span><span class="p">,</span> <span class="n">coi</span> <span class="o">=</span> <span class="n">motherfunc</span><span class="p">(</span><span class="n">mother</span><span class="p">,</span>
                                                           <span class="n">k</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">fx</span><span class="o">*</span><span class="n">nowf</span><span class="p">)</span>
    <span class="n">coi</span><span class="o">=</span><span class="n">coi</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="n">n0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n0</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">wave</span><span class="p">[:,:</span><span class="n">n0</span><span class="p">],</span> <span class="n">period</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">coi</span></div>

<div class="viewcode-block" id="iwavelet"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.iwavelet.html#fisspy.analysis.wavelet.iwavelet">[docs]</a><span class="k">def</span> <span class="nf">iwavelet</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dj</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">mother</span><span class="o">=</span><span class="s1">&#39;MORLET&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse the wavelet to get the time-series</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ~numpy.ndarray</span>
<span class="sd">        wavelet power.</span>
<span class="sd">    scale : ~numpy.ndarray</span>
<span class="sd">        The vecotr of scale indices, given by :math:`s_0 \cdot 2^{j \cdot dj}`</span>
<span class="sd">    dt : float</span>
<span class="sd">        The time step between each y values.</span>
<span class="sd">    dj : (optional) float</span>
<span class="sd">        The spacing between discrete scales.</span>
<span class="sd">        The smaller, the better scale resolution.</span>
<span class="sd">            * Default is 0.25</span>
<span class="sd">    mother : (optional) str</span>
<span class="sd">        The mother wavelet function.</span>
<span class="sd">        The choices are &#39;MORLET&#39;, &#39;PAUL&#39;, or &#39;DOG&#39;</span>
<span class="sd">            * Default is **&#39;MORLET&#39;**</span>
<span class="sd">    param : (optional) int</span>
<span class="sd">        The mother wavelet parameter.\n</span>
<span class="sd">        For **&#39;MORLET&#39;** param is k0, default is **6**.\n</span>
<span class="sd">        For **&#39;PAUL&#39;** param is m, default is **4**.\n</span>
<span class="sd">        For **&#39;DOG&#39;** param is m, default is **2**.\n</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    iwave : ~numpy.ndarray</span>
<span class="sd">        Inverse wavelet.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        This function based on the IDL code WAVELET.PRO written by C. Torrence, </span>
<span class="sd">        and Python code waveletFuncitions.py written by E. Predybayalo.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">        </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from fisspy.analysis import wavelet</span>
<span class="sd">    &gt;&gt;&gt; iwave=wavelet.iwavelet(wave,scale,dt)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">scale2</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">scale</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">mother</span><span class="o">=</span><span class="n">mother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input array dimensions do mot match.&#39;</span><span class="p">)</span>
    
    <span class="n">fourier_factor</span><span class="p">,</span> <span class="n">dofmin</span><span class="p">,</span> <span class="n">cdelta</span><span class="p">,</span> <span class="n">gamma_fac</span><span class="p">,</span> <span class="n">dj0</span> <span class="o">=</span> <span class="n">motherparam</span><span class="p">(</span><span class="n">mother</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cdelta</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cdelta undefined, cannot inverse with this wavelet&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;MORLET&#39;</span><span class="p">:</span>
        <span class="n">psi0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;PAUL&#39;</span><span class="p">:</span>
        <span class="n">psi0</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">param</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;DOG&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">psi0</span><span class="o">=</span><span class="mf">0.867325</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">psi0</span><span class="o">=</span><span class="mf">0.88406</span>
    
    <span class="n">iwave</span><span class="o">=</span><span class="n">dj</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">cdelta</span><span class="o">*</span><span class="n">psi0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scale2</span><span class="p">,</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">iwave</span></div>

<div class="viewcode-block" id="motherfunc"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.motherfunc.html#fisspy.analysis.wavelet.motherfunc">[docs]</a><span class="k">def</span> <span class="nf">motherfunc</span><span class="p">(</span><span class="n">mother</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Fourier factor and period.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mother : str</span>
<span class="sd">        A string, Equal to &#39;MORLET&#39; or &#39;PAUL&#39; or &#39;DOG&#39;.</span>
<span class="sd">    k : 1d ndarray</span>
<span class="sd">        The Fourier frequencies at which to calculate the wavelet.</span>
<span class="sd">    scale : ~numpy.ndarray</span>
<span class="sd">        The wavelet scale.</span>
<span class="sd">    param : int</span>
<span class="sd">        The nondimensional parameter for the wavelet function.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nowf : ~numpy.ndarray</span>
<span class="sd">        The nonorthogonal wavelet function.</span>
<span class="sd">    period : ~numpy.ndarrary</span>
<span class="sd">        The vecotr of &quot;Fourier&quot; periods (in time units)</span>
<span class="sd">    fourier_factor : float</span>
<span class="sd">        the ratio of Fourier period to scale.</span>
<span class="sd">    coi : int</span>
<span class="sd">        The cone-of-influence size at the scale.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        This function based on the IDL code WAVELET.PRO written by C. Torrence, </span>
<span class="sd">        and Python code waveletFuncitions.py written by E. Predybayalo.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">        </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; nowf, period, fourier_factor, coi = motherfunc(mother,k, scale,param)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mother</span><span class="o">=</span><span class="n">mother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">kp</span> <span class="o">=</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mf">0.</span>
    <span class="n">scale2</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
    <span class="k">if</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;MORLET&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">6.</span>
        <span class="n">expn</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="n">param</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">kp</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">scale2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">nowf</span> <span class="o">=</span> <span class="n">norm</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expn</span><span class="p">)</span><span class="o">*</span><span class="n">kp</span><span class="o">*</span><span class="p">(</span><span class="n">expn</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">coi</span> <span class="o">=</span> <span class="n">fourier_factor</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
        
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;PAUL&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">expn</span> <span class="o">=</span> <span class="o">-</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">kp</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">param</span><span class="o">*</span><span class="p">(</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">param</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">nowf</span> <span class="o">=</span> <span class="n">norm</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expn</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="n">kp</span><span class="o">*</span><span class="p">(</span><span class="n">expn</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">coi</span> <span class="o">=</span> <span class="n">fourier_factor</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
        
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;DOG&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">expn</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">gamma</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">nowf</span> <span class="o">=</span> <span class="o">-</span><span class="n">norm</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">**</span><span class="n">param</span><span class="o">*</span><span class="p">(</span><span class="n">scale2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="n">param</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expn</span><span class="p">)</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">coi</span> <span class="o">=</span> <span class="n">fourier_factor</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mother must be one of MORLET, PAUL, DOG</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="s1">&#39;mother = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">repr</span><span class="p">(</span><span class="n">mother</span><span class="p">))</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">fourier_factor</span>
    <span class="k">return</span> <span class="n">nowf</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">fourier_factor</span><span class="p">,</span> <span class="n">coi</span></div>

<div class="viewcode-block" id="motherparam"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.motherparam.html#fisspy.analysis.wavelet.motherparam">[docs]</a><span class="k">def</span> <span class="nf">motherparam</span><span class="p">(</span><span class="n">mother</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the some values for given mother function of wavelet.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mother : str</span>
<span class="sd">    param : int</span>
<span class="sd">        The nondimensional parameter for the wavelet function.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fourier_factor : float</span>
<span class="sd">        the ratio of Fourier period to scale.</span>
<span class="sd">    dofmin : float</span>
<span class="sd">        Degrees of freedom for each point in the wavelet power.</span>
<span class="sd">        (either 2 for MORLET and PAUL, or 1 for the DOG)</span>
<span class="sd">    cdelta : float</span>
<span class="sd">        Reconstruction factor.</span>
<span class="sd">    gamma_fac : float</span>
<span class="sd">        decorrelation factor for time averaging.</span>
<span class="sd">    dj0 : float</span>
<span class="sd">        factor for scale averaging.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        This function based on the IDL code WAVELET.PRO written by C. Torrence, </span>
<span class="sd">        and Python code waveletFuncitions.py written by E. Predybayalo.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; fourier_factor, dofmin, cdelta,gamma_fac, dj0 = motherparam(mother,param)</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mother</span><span class="o">=</span><span class="n">mother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;MORLET&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">6.</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">dofmin</span><span class="o">=</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="mf">6.</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="mf">0.776</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="mf">2.32</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="mf">0.60</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;PAUL&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dofmin</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="mf">4.</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="mf">1.132</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="mf">1.17</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">mother</span> <span class="o">==</span> <span class="s1">&#39;DOG&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">fourier_factor</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">dofmin</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="mf">2.</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="mf">3.541</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="mf">1.43</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="mf">1.4</span>
        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span><span class="mf">6.</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="mf">1.966</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="mf">1.37</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="mf">0.97</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdelta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">gamma_fac</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dj0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mother must be one of MORLET, PAUL, DOG&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fourier_factor</span><span class="p">,</span> <span class="n">dofmin</span><span class="p">,</span> <span class="n">cdelta</span><span class="p">,</span> <span class="n">gamma_fac</span><span class="p">,</span> <span class="n">dj0</span></div>
    
<div class="viewcode-block" id="wave_signif"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.wave_signif.html#fisspy.analysis.wavelet.wave_signif">[docs]</a><span class="k">def</span> <span class="nf">wave_signif</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">sigtest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">mother</span><span class="o">=</span><span class="s1">&#39;MORLET&#39;</span><span class="p">,</span>
                <span class="n">param</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">lag1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">siglvl</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="n">dof</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">gws</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">confidence</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the significance levels for a wavelet transform.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : float or ~numpy.ndarray</span>
<span class="sd">        The time series, or the variance of the time series.</span>
<span class="sd">        If this is a single number, it is assumed to be the variance.</span>
<span class="sd">    dt : float</span>
<span class="sd">        The sampling time.</span>
<span class="sd">    scale : ~numpy.ndarray</span>
<span class="sd">        The vecotr of scale indices, from previous call to WAVELET.</span>
<span class="sd">    sigtest : (optional) int</span>
<span class="sd">        Allowable values are 0, 1, or 2</span>
<span class="sd">        if 0 (default), then just do a regular chi-square test</span>
<span class="sd">            i.e. Eqn (18) from Torrence &amp; Compo.</span>
<span class="sd">        If 1, then do a &quot;time-average&quot; test, i.e. Eqn (23).</span>
<span class="sd">            in this case, dof should be set to False,</span>
<span class="sd">            the nuber of local wavelet spectra </span>
<span class="sd">            that were averaged together.</span>
<span class="sd">            For the Global Wavelet Spectrum(GWS), this would be N,</span>
<span class="sd">            where N is the number of points in y</span>
<span class="sd">        If 2, then do a &quot;scale-average&quot; test, i.e. Eqns (25)-(28).</span>
<span class="sd">            In this case, dof should be set to a two-element vector,</span>
<span class="sd">            which gives the scale range that was averaged together.</span>
<span class="sd">            e.g. if one scale-averaged scales between 2 and 8,</span>
<span class="sd">            then dof=[2,8]</span>
<span class="sd">    lag1 : (optional) float</span>
<span class="sd">        LAG 1 Autocorrelation, used for signif levels.</span>
<span class="sd">            * Default is 0.</span>
<span class="sd">    siglvl : (optional) float</span>
<span class="sd">        Significance level to use.</span>
<span class="sd">            * Default is 0.95</span>
<span class="sd">    dof : (optional) float</span>
<span class="sd">        degrees-of-freedom for sgnif test.</span>
<span class="sd">            * Default is -1, and it means the False.</span>

<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        signif : ~numpy.ndarray</span>
<span class="sd">            Significance levels as a function of scale.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    IF SIGTEST=1, then DOF can be a vector (same length as SCALEs), </span>
<span class="sd">    in which case NA is assumed to vary with SCALE. </span>
<span class="sd">    This allows one to average different numbers of times </span>
<span class="sd">    together at different scales, or to take into account </span>
<span class="sd">    things like the Cone of Influence.\n</span>
<span class="sd">    See discussion following Eqn (23) in Torrence &amp; Compo.\n</span>
<span class="sd">    This function based on the IDL code WAVE_SIGNIF.PRO written by C. Torrence, </span>
<span class="sd">    and Python code waveletFuncitions.py written by E. Predybayalo.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; signif=wavelet.wave_signif(y,dt,scale,2,mother=&#39;morlet&#39;,dof=[s1,s2],gws=gws)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    
    <span class="n">fourier_factor</span><span class="p">,</span> <span class="n">dofmin</span><span class="p">,</span> <span class="n">cdelta</span><span class="p">,</span> <span class="n">gamma_fac</span><span class="p">,</span> <span class="n">dj0</span> <span class="o">=</span> <span class="n">motherparam</span><span class="p">(</span><span class="n">mother</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">fourier_factor</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="n">period</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">gws</span><span class="p">)</span>
        <span class="n">fft_theor</span> <span class="o">=</span> <span class="n">gws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">fft_theor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lag1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">lag1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="n">lag1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fft_theor</span><span class="o">*=</span><span class="n">var</span>


    <span class="n">signif</span> <span class="o">=</span> <span class="n">fft_theor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">sigtest</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="n">dofmin</span>
        <span class="n">signif</span> <span class="o">=</span> <span class="n">fft_theor</span> <span class="o">*</span> <span class="n">chisquare_inv</span><span class="p">(</span><span class="n">siglvl</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span><span class="o">/</span><span class="n">dof</span>
        <span class="k">if</span> <span class="n">confidence</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">siglvl</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">chisqr</span> <span class="o">=</span> <span class="n">dof</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">chisquare_inv</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">),</span>
                                   <span class="n">chisquare_inv</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">)))</span>
            <span class="n">signif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">chisqr</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">fft_theor</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span>
    <span class="k">elif</span> <span class="n">sigtest</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gamma_fac</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;gamma_fac(decorrelation facotr) not defined for &#39;</span>
                             <span class="s1">&#39;mother = </span><span class="si">%s</span><span class="s1"> with param = </span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">mother</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">dof</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">dof</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">dofmin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">dof</span>
        <span class="n">dof</span><span class="p">[</span><span class="n">dof</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="n">dofmin</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">dof</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">gamma_fac</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">dof</span><span class="p">[</span><span class="n">dof</span> <span class="o">&lt;=</span> <span class="n">dofmin</span><span class="p">]</span> <span class="o">=</span> <span class="n">dofmin</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">confidence</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="n">chisqr</span> <span class="o">=</span> <span class="n">chisquare_inv</span><span class="p">(</span><span class="n">siglvl</span><span class="p">,</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">signif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chisqr</span><span class="o">*</span><span class="n">fft_theor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">siglvl</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="n">chisqr</span> <span class="o">=</span> <span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">chisquare_inv</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">chisquare_inv</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="n">signif</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_theor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">chisqr</span>
    <span class="k">elif</span> <span class="n">sigtest</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;DOF must be set to [s1,s2], the range of scale-averages&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cdelta</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cdelta &amp; dj0 not defined for&#39;</span>
                             <span class="s1">&#39;mother = </span><span class="si">%s</span><span class="s1"> with param = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">mother</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)))</span>
        <span class="n">dj</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">period</span><span class="o">&gt;=</span><span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">period</span><span class="o">&lt;=</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">navg</span> <span class="o">=</span> <span class="n">avg</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">navg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No valid scales between </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span>
        <span class="n">s1</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="n">avg</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">s2</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="n">avg</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">savg</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">scale</span><span class="p">[</span><span class="n">avg</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">smid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">s2</span><span class="p">))</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="p">(</span><span class="n">dofmin</span><span class="o">*</span><span class="n">navg</span><span class="o">*</span><span class="n">savg</span><span class="o">/</span><span class="n">smid</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">navg</span><span class="o">*</span><span class="n">dj</span><span class="o">/</span><span class="n">dj0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">fft_theor</span> <span class="o">=</span> <span class="n">savg</span><span class="o">*</span><span class="p">(</span><span class="n">fft_theor</span><span class="p">[</span><span class="n">avg</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">[</span><span class="n">avg</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">chisqr</span> <span class="o">=</span> <span class="n">chisquare_inv</span><span class="p">(</span><span class="n">siglvl</span><span class="p">,</span><span class="n">dof</span><span class="p">)</span><span class="o">/</span><span class="n">dof</span>
        <span class="k">if</span> <span class="n">confidence</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">siglvl</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">chisqr</span> <span class="o">=</span> <span class="n">dof</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">chisquare_inv</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">),</span><span class="n">chisquare_inv</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">dof</span><span class="p">)))</span>
        <span class="n">signif</span> <span class="o">=</span> <span class="p">(</span><span class="n">dj</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">cdelta</span><span class="o">/</span><span class="n">savg</span><span class="p">)</span><span class="o">*</span><span class="n">fft_theor</span><span class="o">*</span><span class="n">chisqr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sigtest must be 0,1, or 2&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">signif</span></div>

<div class="viewcode-block" id="chisquare_inv"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.chisquare_inv.html#fisspy.analysis.wavelet.chisquare_inv">[docs]</a><span class="k">def</span> <span class="nf">chisquare_inv</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse of chi-square cumulative distribution function(CDF).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        probability</span>
<span class="sd">    v : float</span>
<span class="sd">        degrees of freedom of the chi-square distribution</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x : float</span>
<span class="sd">        the inverse of chi-square cdf</span>
<span class="sd">        </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; result = chisquare_inv(p,v)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p must be 0&lt;p&lt;1&#39;</span><span class="p">)</span>
    <span class="n">minv</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">maxv</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">4</span>
    <span class="k">while</span> <span class="n">x</span><span class="o">+</span><span class="n">tolerance</span> <span class="o">&gt;=</span> <span class="n">maxv</span><span class="p">:</span>
        <span class="n">maxv</span><span class="o">*=</span><span class="mf">10.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fmin</span><span class="p">(</span><span class="n">chisquare_solve</span><span class="p">,</span> <span class="n">minv</span><span class="p">,</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">),</span> <span class="n">xtol</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="n">minv</span> <span class="o">=</span> <span class="n">maxv</span>
    <span class="n">x</span><span class="o">*=</span><span class="n">v</span>
    <span class="k">return</span> <span class="n">x</span></div>
    
<div class="viewcode-block" id="chisquare_solve"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.chisquare_solve.html#fisspy.analysis.wavelet.chisquare_solve">[docs]</a><span class="k">def</span> <span class="nf">chisquare_solve</span><span class="p">(</span><span class="n">xguess</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chisqure_solve</span>
<span class="sd">    </span>
<span class="sd">    Return the difference between calculated percentile and P.</span>
<span class="sd">    </span>
<span class="sd">    Written January 1998 by C. Torrence</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pguess</span> <span class="o">=</span> <span class="n">gammainc</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">v</span><span class="o">*</span><span class="n">xguess</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pguess</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pguess</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">pdiff</span> <span class="o">=</span> <span class="n">xguess</span>
    <span class="k">return</span> <span class="n">pdiff</span></div>

<div class="viewcode-block" id="wave_coherency"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.wave_coherency.html#fisspy.analysis.wavelet.wave_coherency">[docs]</a><span class="k">def</span> <span class="nf">wave_coherency</span><span class="p">(</span><span class="n">wave1</span><span class="p">,</span><span class="n">time1</span><span class="p">,</span><span class="n">scale1</span><span class="p">,</span><span class="n">wave2</span><span class="p">,</span><span class="n">time2</span><span class="p">,</span><span class="n">scale2</span><span class="p">,</span>
                   <span class="n">dt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">dj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">coi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">nosmooth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the wavelet coherency between two time series.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave1 : ~numpy.ndarray</span>
<span class="sd">        Wavelet power spectrum for time series 1.</span>
<span class="sd">    time1 : ~numpy.ndarray</span>
<span class="sd">        A vector of times for time series 1.</span>
<span class="sd">    scale1 : ~numpy.ndarray</span>
<span class="sd">        A vector of scales for time series 1.</span>
<span class="sd">    wave2 : ~numpy.ndarray</span>
<span class="sd">        Wavelet power spectrum for time series 2.</span>
<span class="sd">    time2 : ~numpy.ndarray</span>
<span class="sd">        A vector of times for time series 2.</span>
<span class="sd">    scale2 : ~numpy.ndarray</span>
<span class="sd">        A vector of scales for time series 2.</span>
<span class="sd">    dt : (optional) float</span>
<span class="sd">        Amount of time between each Y value, i.e. the sampling time.</span>
<span class="sd">            If not input, then calculated from time1[1]-time1[0]</span>
<span class="sd">    dj : (optional) float</span>
<span class="sd">        The spacing between discrete scales.</span>
<span class="sd">            If not input, then calculated from scale1</span>
<span class="sd">    coi : (optional) ~numpy.ndarray</span>
<span class="sd">        The array of the cone-of influence.</span>
<span class="sd">    nosmooth : (optional) bool</span>
<span class="sd">        If True, then just compute the global_coher, global_phase, and</span>
<span class="sd">        the unsmoothed cross_wavelet and return.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        The result is dictionary has these information.</span>
<span class="sd">        </span>
<span class="sd">        cross_wavelet : ~numpy.ndarray</span>
<span class="sd">            The cross wavelet between the time series.</span>
<span class="sd">        time : ~numpy.ndarray</span>
<span class="sd">            The time array given by the overlap of time1 and time2.</span>
<span class="sd">        scale : ~numpy.ndarray</span>
<span class="sd">            The scale array of scale indices, given by the overlap of </span>
<span class="sd">            scale1 and scale2.</span>
<span class="sd">        wave_phase : ~numpy.ndarray</span>
<span class="sd">            The phase difference between time series 1 and time series 2.</span>
<span class="sd">        wave_coher : ~numpy.ndarray</span>
<span class="sd">            The wavelet coherency, as a function of time and scale.</span>
<span class="sd">        global_phase : ~numpy.ndarray</span>
<span class="sd">            The global (or mean) phase averaged over all times.</span>
<span class="sd">        global_coher : ~numpy.ndarray</span>
<span class="sd">            The global (or mean) coherence averaged over all times.</span>
<span class="sd">        power1 : ~numpy.ndarray</span>
<span class="sd">            The wavelet power spectrum should be the same as wave1</span>
<span class="sd">            if time1 and time2 are identical, otherwise it is only the</span>
<span class="sd">            overlapping portion. If nosmooth is set,</span>
<span class="sd">            then this is unsmoothed, otherwise it is smoothed.</span>
<span class="sd">        power2 : ~numpy.ndarray</span>
<span class="sd">            same as power 1 but for time series 2.</span>
<span class="sd">        coi : ~numpy.ndarray</span>
<span class="sd">            The array of the cone-of influence.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        This function based on the IDL code WAVE_COHERENCY.PRO written by C. Torrence, </span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Torrence, C. and Compo, G. P., 1998, A Practical Guide to Wavelet Analysis, </span>
<span class="sd">    *Bull. Amer. Meteor. Soc.*, `79, 61-78 &lt;http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf&gt;`_.\n</span>
<span class="sd">    http://paos.colorado.edu/research/wavelets/</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; res=wavelet.wave_coherency(wave1,time1,scale1,wave2,time2,scale2,\</span>
<span class="sd">dt,dj,coi=coi)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dt</span><span class="p">:</span> <span class="n">dt</span><span class="o">=</span><span class="n">time1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">time1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dj</span><span class="p">:</span> <span class="n">dj</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">scale1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">time1</span> <span class="ow">is</span> <span class="n">time2</span><span class="p">:</span>
        <span class="n">t1s</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">t1e</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">time1</span><span class="p">)</span>
        <span class="n">t2s</span><span class="o">=</span><span class="n">t1s</span>
        <span class="n">t2e</span><span class="o">=</span><span class="n">t1e</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">otime_start</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="n">time1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">time2</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
        <span class="n">otime_end</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">time1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">time2</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="n">t1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">time1</span> <span class="o">&gt;=</span> <span class="n">otime_start</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">time1</span> <span class="o">&lt;=</span> <span class="n">otime_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t1s</span><span class="o">=</span><span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t1e</span><span class="o">=</span><span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">time2</span> <span class="o">&gt;=</span> <span class="n">otime_start</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">time2</span> <span class="o">&lt;=</span> <span class="n">otime_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t2s</span><span class="o">=</span><span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t2e</span><span class="o">=</span><span class="n">t2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="n">oscale_start</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="n">scale1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">scale2</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
    <span class="n">oscale_end</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">scale1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">scale2</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">s1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">scale1</span> <span class="o">&gt;=</span> <span class="n">oscale_start</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">scale1</span> <span class="o">&lt;=</span> <span class="n">oscale_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">scale2</span> <span class="o">&gt;=</span> <span class="n">oscale_start</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">scale2</span> <span class="o">&lt;=</span> <span class="n">oscale_end</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s1s</span><span class="o">=</span><span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s1e</span><span class="o">=</span><span class="n">s1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">s2s</span><span class="o">=</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s2e</span><span class="o">=</span><span class="n">s2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="n">cross_wavelet</span><span class="o">=</span><span class="n">wave1</span><span class="p">[</span><span class="n">s1s</span><span class="p">:</span><span class="n">s1e</span><span class="p">,</span><span class="n">t1s</span><span class="p">:</span><span class="n">t1e</span><span class="p">]</span><span class="o">*</span><span class="n">wave2</span><span class="p">[</span><span class="n">s2s</span><span class="p">:</span><span class="n">s2e</span><span class="p">,</span><span class="n">t2s</span><span class="p">:</span><span class="n">t2e</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
    <span class="n">power1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave1</span><span class="p">[</span><span class="n">s1s</span><span class="p">:</span><span class="n">s1e</span><span class="p">,</span><span class="n">t1s</span><span class="p">:</span><span class="n">t1e</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">power2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave2</span><span class="p">[</span><span class="n">s2s</span><span class="p">:</span><span class="n">s2e</span><span class="p">,</span><span class="n">t2s</span><span class="p">:</span><span class="n">t2e</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="n">time</span><span class="o">=</span><span class="n">time1</span><span class="p">[</span><span class="n">t1s</span><span class="p">:</span><span class="n">t1e</span><span class="p">]</span>
    <span class="n">scale</span><span class="o">=</span><span class="n">scale1</span><span class="p">[</span><span class="n">s1s</span><span class="p">:</span><span class="n">s1e</span><span class="p">]</span>
    <span class="n">nj</span><span class="o">=</span><span class="n">s1e</span><span class="o">-</span><span class="n">s1s</span>
    
    <span class="n">global1</span><span class="o">=</span><span class="n">power1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">global2</span><span class="o">=</span><span class="n">power2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">global_cross</span> <span class="o">=</span> <span class="n">cross_wavelet</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">global_coher</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">global_cross</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">global1</span><span class="o">*</span><span class="n">global2</span><span class="p">)</span>
    <span class="n">global_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">global_cross</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">global_cross</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
    <span class="k">if</span> <span class="n">nosmooth</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">global_coherence</span><span class="o">=</span><span class="n">global_coher</span><span class="p">,</span><span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">,</span>
                      <span class="n">cross_wavelet</span><span class="o">=</span><span class="n">cross_wavelet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="n">nt</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">scale</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">nt2</span><span class="o">=</span><span class="n">nt</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">ntmax</span><span class="o">=</span><span class="n">nt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntmax</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nj</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">wh</span><span class="o">=</span><span class="n">g</span> <span class="o">&gt;=</span> <span class="n">nt2</span>
    <span class="n">time_wavelet</span><span class="o">=</span><span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">nt2</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">scale</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">wave_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">time_wavelet</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">wave_func</span><span class="p">[</span><span class="n">wh</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">wave_func</span><span class="o">=</span><span class="p">(</span><span class="n">wave_func</span><span class="o">/</span><span class="n">wave_func</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>
    <span class="n">cross_wavelet</span><span class="o">=</span><span class="n">fast_conv</span><span class="p">(</span><span class="n">cross_wavelet</span><span class="p">,</span><span class="n">wave_func</span><span class="p">,</span><span class="n">nt2</span><span class="p">)</span>
    <span class="n">power1</span><span class="o">=</span><span class="n">fast_conv</span><span class="p">(</span><span class="n">power1</span><span class="p">,</span><span class="n">wave_func</span><span class="p">,</span><span class="n">nt2</span><span class="p">)</span>
    <span class="n">power2</span><span class="o">=</span><span class="n">fast_conv</span><span class="p">(</span><span class="n">power2</span><span class="p">,</span><span class="n">wave_func</span><span class="p">,</span><span class="n">nt2</span><span class="p">)</span>
    <span class="n">scales</span><span class="o">=</span><span class="n">scale</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">cross_wavelet</span><span class="o">/=</span><span class="n">scales</span>
    <span class="n">power1</span><span class="o">/=</span><span class="n">scales</span>
    <span class="n">power2</span><span class="o">/=</span><span class="n">scales</span>
    
    <span class="n">nw</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.6</span><span class="o">/</span><span class="n">dj</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">weight</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nw</span><span class="p">)</span><span class="o">/</span><span class="n">nw</span>
    <span class="n">cross_wavelet</span><span class="o">=</span><span class="n">fast_conv2</span><span class="p">(</span><span class="n">cross_wavelet</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">power1</span><span class="o">=</span><span class="n">fast_conv2</span><span class="p">(</span><span class="n">power1</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">power2</span><span class="o">=</span><span class="n">fast_conv2</span><span class="p">(</span><span class="n">power2</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    
    <span class="n">wave_phase</span><span class="o">=</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">cross_wavelet</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">cross_wavelet</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">power3</span><span class="o">=</span><span class="n">power1</span><span class="o">*</span><span class="n">power2</span>
    <span class="n">whp</span><span class="o">=</span><span class="n">power3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>
    <span class="n">power3</span><span class="p">[</span><span class="n">whp</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>
    <span class="n">wave_coher</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cross_wavelet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">power3</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    
    <span class="n">result</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">cross_wavelet</span><span class="o">=</span><span class="n">cross_wavelet</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">wave_phase</span><span class="o">=</span><span class="n">wave_phase</span><span class="p">,</span><span class="n">wave_coher</span><span class="o">=</span><span class="n">wave_coher</span><span class="p">,</span>
                <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">,</span><span class="n">global_coher</span><span class="o">=</span><span class="n">global_coher</span><span class="p">,</span>
                <span class="n">power1</span><span class="o">=</span><span class="n">power1</span><span class="p">,</span><span class="n">power2</span><span class="o">=</span><span class="n">power2</span><span class="p">,</span><span class="n">coi</span><span class="o">=</span><span class="n">coi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>





<div class="viewcode-block" id="fast_conv"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.fast_conv.html#fisspy.analysis.wavelet.fast_conv">[docs]</a><span class="k">def</span> <span class="nf">fast_conv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">nt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast convolution two given function f and g (method 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nf</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ng</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">npad</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ng</span><span class="p">[</span><span class="mi">1</span><span class="p">]])))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">wh1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">wh2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">nt</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">pf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">npad</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">pg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">npad</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">pf</span><span class="p">[:,:</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">f</span>
    <span class="n">pg</span><span class="p">[:,:</span><span class="n">ng</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">g</span>
    <span class="n">conv</span><span class="o">=</span><span class="n">ifft</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span><span class="o">*</span><span class="n">fft</span><span class="p">(</span><span class="n">pg</span><span class="p">[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">result</span><span class="o">=</span><span class="n">conv</span><span class="p">[</span><span class="n">wh1</span><span class="p">,</span><span class="n">wh2</span><span class="o">.</span><span class="n">T</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="fast_conv2"><a class="viewcode-back" href="../../../generated/api/fisspy.analysis.wavelet.fast_conv2.html#fisspy.analysis.wavelet.fast_conv2">[docs]</a><span class="k">def</span> <span class="nf">fast_conv2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast convolution two given function f and g (method2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nf</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ng</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">npad</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ng</span><span class="p">])))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">wh1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">wh2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">+</span><span class="n">ng</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">pf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">npad</span><span class="p">,</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">pg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">npad</span><span class="p">,</span><span class="n">nf</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">pf</span><span class="p">[:</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">=</span><span class="n">f</span>
    <span class="n">pg</span><span class="p">[:</span><span class="n">ng</span><span class="p">,:]</span><span class="o">=</span><span class="n">g</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">conv</span><span class="o">=</span><span class="n">ifft</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">pf</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">fft</span><span class="p">(</span><span class="n">pg</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span><span class="o">=</span><span class="n">conv</span><span class="p">[</span><span class="n">wh2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">wh1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SNU Solar Group.
      Last updated on 23 Feb 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>